version: '3.1'

services:
  deepstream:
    image: docker.garlictech.com/gtrack-deepstream-staging:latest
    ports:
      - 6020:6020
    env_file:
      - ./service.env
      - ./tokens.env
    environment:
      - RETHINKDB_USER=admin
      - RETHINKDB_PASSWORD=''
    depends_on:
      - rethinkdb
      - redis
    restart: always
    secrets:
      - DEEPSTREAM_PROVIDER_JWT_SECRET

  redis:
    image: redis:alpine

  rethinkdb:
    image: rethinkdb
    ports:
      - "28016:28016"
      - "8091:8080"
  deepstream_providers:
    image: docker.garlictech.com/gtrack-deepstream-providers-staging
    env_file:
      - ./service.env
      - ./tokens.env
    depends_on:
      - deepstream
    restart: always
    secrets:
      - DEEPSTREAM_PROVIDER_JWT_SECRET

secrets:
  DEEPSTREAM_PROVIDER_JWT_SECRET:
    file: secrets/DEEPSTREAM_PROVIDER_JWT_SECRET.secret.txt
  DEEPSTREAM_USER_JWT_SECRET:
    file: secrets/DEEPSTREAM_USER_JWT_SECRET.secret.txt
